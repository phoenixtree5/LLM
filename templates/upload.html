<!DOCTYPE html>
{% load static %}

<html>
<head>
<meta charset="UTF-8">
<title>Upload Resource</title>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<!-- 引入CSS文件 -->
<link href="{% static 'css/bootstrap.css' %}" rel="stylesheet">
<link href="{% static 'css/style.css' %}" rel="stylesheet">
<link href="{% static 'css/responsive.css'%} " rel="stylesheet">

<link rel="shortcut icon" href="{% static 'images/favicon.png' %}" type="image/x-icon">
<link rel="icon" href="{% static 'images/favicon.png' %}" type="image/x-icon">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
</head>
<body>

    <header class="main-header">
        <div class="header-upper">
        <div class="auto-container">
            <div class="clearfix">
                <div class="nav-outer clearfix">    
                    <nav class="main-menu navbar-expand-md">

                        <div class="navbar-collapse collapse clearfix" id="navbarSupportedContent">
                            <ul class="navigation clearfix">
                                <li class="dropdown"><a href="">主页</a></li>
                                <li class="dropdown"><a href="">资源搜索</a></li>
                                <li class="dropdown"><a href="">资源上传</a></li>
                                <li class="dropdown"><a href="">个人空间</a></li>
                                <li class="dropdown"><a href="">我的资源</a></li>
                            </ul>
                        </div>
                        
                    </nav>
            </div>
        </div>
    </div>

    </header>

    <section class="page-title">
    	<div class="auto-container">
        	<h1>Upload Resource</h1>
        </div>
    </section>




    <div class="container">
        <div class="form-container">
            <div class="header">上传资源</div>
            <form id="uploadForm" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="form-group">
                    <label for="fileName">文件名称：</label>
                    <input type="text" id="name" name="name" placeholder="文件名称" required>
                </div>
                <div class="form-group">
                    <label for="fileType">选择文件类型：</label>
                    <select id="type" name="type" required>
                        <option value="type1">数据</option>
                        <option value="type2">算法库</option>
                        <option value="type3">说明文档</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="fileValue">分值设置：</label>
                    <input type="text" id="value" name="value" placeholder="设置分值" required>
                </div>
                <div class="form-group">
                    <label for="fileDescription">填写资源简介：</label>
                    <textarea id="description" name="description" placeholder="资源简介" required></textarea>
                </div>
                <div class="form-group">
                    <label for="file">Select file:</label>
                    <input type="file" id="file" name="file" required><br><br>
                </div>
                <div class="form-group">
                    <label>查看已上传文件：</label>
                    <div>
                        <input type="text" value="已上传文件" readonly>
                        <a href="#">删除文件</a>
                    </div>
                </div>
                <div class="submit-button">
                    <button type="submit">提交</button>
                </div>
            </form>
        </div>
        <div class="upload-rules">
            <div class="rule" onclick="showModal('requirement')">1. 上传要求</div>
            <div class="rule" onclick="showModal('steps')">2. 上传步骤</div>
            <div class="rule" onclick="showModal('calculation')">3. 分值计算</div>
        </div>
    </div>

    <!-- The Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modal-text"></div>
        </div>
    </div>

    <script>
        const modal = document.getElementById("myModal");
        const modalText = document.getElementById("modal-text");

        function showModal(ruleType) {
            let content = '';
            if (ruleType === 'requirement') {
                content = '资源名字：用户需要为每个上传的资源填写一个唯一的资源名称，便于识别和搜索。\n. 类型：选择资源的类型，包括但不限于数据集、算法库、说明文档等。\n. 分值：设置资源的分值，分值将影响其他用户下载资源时需要支付的分值。\n. 简介：提供资源的简要描述，包括用途、特点和适用场景，帮助其他用户了解资源内容。\n. 文件：支持上传多个文件，可以上传资源的多个部分或相关文档。每个文件大小不超过500MB，总文件大小不超过2GB。';
            } else if (ruleType === 'steps') {
                content = '用户登录后，点击“上传资源”按钮。\n. 填写资源名字、选择资源类型。\n. 设置资源的分值。\n. 填写资源简介。\n. 选择并上传文件，支持多个文件上传。\n. 检查填写的信息和上传的文件，确认无误后点击“提交”。\n. 根据上传资源得到分值的规则.\n. 用户上传资源后，系统将根据以下规则计算用户的分值奖励：';
            } else if (ruleType === 'calculation') {
                content = '资源类型：\n. 数据集：基础分值 +10 分\n. 算法库：基础分值 +8 分\n. 说明文档：基础分值 +5 分\n. 其他资源：基础分值 +6 分\n\n. 文件数量：\n. 每个文件额外奖励 1 分\n\n. 文件大小：\n. 小于 50MB：+1 分\n. 50MB - 100MB：+2 分\n. 100MB - 500MB：+5 分\n. 500MB - 1GB：+8 分\n. 大于 1GB：+10 分\n\n. 资源分值设置：\n. 用户设置的资源分值/2，作为额外奖励。';
            }
            modalText.innerHTML = content.replace(/\n/g, '<br>'); // Replace newlines with <br>
            modal.style.display = "block";
        }

        function closeModal() {
            modal.style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target === modal) {
                modal.style.display = "none";
            }
        }

        document.getElementById('uploadForm').onsubmit = async function(e) {
            e.preventDefault();

            let formData = new FormData();
            formData.append('name', document.getElementById('name').value);
            formData.append('file', document.getElementById('file').files[0]);
            formData.append('type', document.getElementById('type').value)
            formData.append('value', document.getElementById('value').value)
            formData.append('description', document.getElementById('description').value)

            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            try {
                let response = await axios.post('/upload/', formData, {
                    headers: {
                        'Content-Type': 'multipart/form-data',
                        'X-CSRFToken': csrfToken
                    }
                });

                if (response.data.success) {
                    alert('File uploaded successfully');
                } else {
                    alert('File upload failed: ' + response.data.message);
                }
            } catch (error) {
                console.error('There was an error uploading the file!', error);
                alert('There was an error uploading the file!');
            }
        };
    </script>
</body>
</html>
